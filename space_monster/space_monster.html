<!doctype html>


<html lang="en">
    <head>

    </head>


    <body>
        <img id="planet" src="images/planet.jpg" alt="Planet" style="display:none">
        <img id="rocket" src="images/rocket.png" alt="Rocket" style="display:none">
        <img id="ufo" src="images/ufo.png" alt="Ufo" style="display:none">
        <img id="bullet" src="images/bullet.png" alt="Bullet" style="display:none">
        <img id="explosion"  src="images/explosion2.png" alt="Explosion" style="display:none">
        <img id="bonus"  src="images/star.jpg" alt="Bonus" style="display:none">



        <canvas id="canvas1" width="800" height="600" style="border:1px solid #000000;"></canvas>





        <script>
        </script>

        <script src="external/jquery_1_11_1.min.js"></script>

        <script type="text/javascript" src="../engine/Util.js"></script>
        <script type="text/javascript" src="../engine/Engine.js"></script>
        <script type="text/javascript" src="../engine/Sprite.js"></script>
        <script type="text/javascript" src="../engine/Animator.js"></script>
        <script type="text/javascript" src="scripts/sprites/BaseSprite.js"></script>
        <script type="text/javascript" src="scripts/sprites/Rocket.js"></script>       
        <script type="text/javascript" src="scripts/sprites/UfoType1.js"></script>
        <script type="text/javascript" src="scripts/sprites/UfoType2.js"></script>
        <script type="text/javascript" src="scripts/sprites/UfoType3.js"></script>
        <script type="text/javascript" src="scripts/sprites/Bullet.js"></script>
        <script type="text/javascript" src="scripts/sprites/Explosion.js"></script>      
        <script type="text/javascript" src="scripts/sprites/Bonus.js"></script>
        <script type="text/javascript" src="scripts/EnemyGenerator.js"></script>
        <script>

            $(window).load(function () {
                var screenWidth = 800;
                var screenHeight = 600;

                var offScreen = function (position) {
                    if (position.x < -1000 || position.x > screenWidth + 1000) {
                        return true;
                    }
                    if (position.y < -1000 || position.y > screenHeight + 1000) {
                        return true;
                    }
                };
               

                var rocket = new Rocket(screenWidth, screenHeight).setImage("rocket").setWidthAndHeight(30, 50).setPosition(400, 500);


                var background = [];
                var planet = new Sprite().setImage("planet").setPosition(0, 0).setWidthAndHeight(screenWidth, screenHeight);
                //background.push(planet);


                var sprites = [];


                var engine = new Engine("canvas1");


                var enemyGenerator = new EnemyGenerator();                

                var points = 0;
                
                sprites.push(rocket);
                
                engine.registerUpdateHandler(function (context, timeSinceStart, keyEvents) {

                    sprites = sprites.concat(enemyGenerator.generateEnemies(timeSinceStart));
                    
                    background.forEach(function (t) {
                        t.draw(context);
                    });
                    
                    

                    var spritesToAdd = [];
                    sprites.forEach(function (each) {
                        if (each.handleKeyEvents) {
                            each.handleKeyEvents(keyEvents);
                        }                        
                        each.update(context, rocket);
                        if (each.bulletFired) {
                            spritesToAdd = spritesToAdd.concat(each.bulletFired());
                        }
                    }); 
                    
                    sprites = sprites.concat(spritesToAdd);
 

                    for (var i1 = 0; i1 < sprites.length; i1++) {
                        for (var i2 = i1; i2 < sprites.length; i2++) {
                            if (sprites[i1].collision(sprites[i2]) && i1 !== i2) {
                                sprites[i1].handleCollision(sprites[i2]);
                                sprites[i2].handleCollision(sprites[i1]);
                            }
                        }
                    }


                    var exposions = [];
                    var pointsForRound = 0;
                    sprites.forEach(function (each) {
                        if (each.isDestroyed()) {
                            exposions = exposions.concat(each.getExplosion());
                            if(each.getPoints() !== 0){
                                pointsForRound = pointsForRound + each.getPoints();
                            } 
                        }
                    });

                    sprites = sprites.concat(exposions);
                    
                    if(pointsForRound !== 0){
                        points = points + pointsForRound;
                        if(points%20000 === 0){
                            sprites.push(new Bonus(screenWidth));
                        }   
                    }

                    sprites = sprites.filter(function (each) {
                        return !each.isDestroyed() && !offScreen(each.getPosition());
                    });

                    return true;

                });

                engine.start();



            });





        </script>





    </body>
</html>


