/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,e){"function"==typeof define&&define.amd?define(e):t.game_engine=e()}(this,function(){var t,e,n;return function(i){function r(t,e){return S.call(t,e)}function o(t,e){var n,i,r,o,u,s,a,f,h,c,d,l=e&&e.split("/"),g=v.map,p=g&&g["*"]||{};if(t&&"."===t.charAt(0))if(e){for(l=l.slice(0,l.length-1),t=t.split("/"),u=t.length-1,v.nodeIdCompat&&A.test(t[u])&&(t[u]=t[u].replace(A,"")),t=l.concat(t),h=0;h<t.length;h+=1)if(d=t[h],"."===d)t.splice(h,1),h-=1;else if(".."===d){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((l||p)&&g){for(n=t.split("/"),h=n.length;h>0;h-=1){if(i=n.slice(0,h).join("/"),l)for(c=l.length;c>0;c-=1)if(r=g[l.slice(0,c).join("/")],r&&(r=r[i])){o=r,s=h;break}if(o)break;!a&&p&&p[i]&&(a=p[i],f=h)}!o&&a&&(o=a,s=f),o&&(n.splice(0,s,o),t=n.join("/"))}return t}function u(t,e){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),l.apply(i,n.concat([t,e]))}}function s(t){return function(e){return o(e,t)}}function a(t){return function(e){m[t]=e}}function f(t){if(r(y,t)){var e=y[t];delete y[t],w[t]=!0,d.apply(i,e)}if(!r(m,t)&&!r(w,t))throw new Error("No "+t);return m[t]}function h(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function c(t){return function(){return v&&v.config&&v.config[t]||{}}}var d,l,g,p,m={},y={},v={},w={},S=Object.prototype.hasOwnProperty,x=[].slice,A=/\.js$/;g=function(t,e){var n,i=h(t),r=i[0];return t=i[1],r&&(r=o(r,e),n=f(r)),r?t=n&&n.normalize?n.normalize(t,s(e)):o(t,e):(t=o(t,e),i=h(t),r=i[0],t=i[1],r&&(n=f(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:n}},p={require:function(t){return u(t)},exports:function(t){var e=m[t];return"undefined"!=typeof e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:c(t)}}},d=function(t,e,n,o){var s,h,c,d,l,v,S=[],x=typeof n;if(o=o||t,"undefined"===x||"function"===x){for(e=!e.length&&n.length?["require","exports","module"]:e,l=0;l<e.length;l+=1)if(d=g(e[l],o),h=d.f,"require"===h)S[l]=p.require(t);else if("exports"===h)S[l]=p.exports(t),v=!0;else if("module"===h)s=S[l]=p.module(t);else if(r(m,h)||r(y,h)||r(w,h))S[l]=f(h);else{if(!d.p)throw new Error(t+" missing "+h);d.p.load(d.n,u(o,!0),a(h),{}),S[l]=m[h]}c=n?n.apply(m[t],S):void 0,t&&(s&&s.exports!==i&&s.exports!==m[t]?m[t]=s.exports:c===i&&v||(m[t]=c))}else t&&(m[t]=n)},t=e=l=function(t,e,n,r,o){if("string"==typeof t)return p[t]?p[t](e):f(g(t,e).f);if(!t.splice){if(v=t,v.deps&&l(v.deps,v.callback),!e)return;e.splice?(t=e,e=n,n=null):t=i}return e=e||function(){},"function"==typeof n&&(n=r,r=o),r?d(i,t,e,n):setTimeout(function(){d(i,t,e,n)},4),l},l.config=function(t){return l(t)},t._defined=m,n=function(t,e,n){e.splice||(n=e,e=[]),r(m,t)||r(y,t)||(y[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("../lib/almond/almond",function(){}),n("Util",{throttled:function(t,e){var n,i;return function(){var r=(new Date).getTime();return n?r-n>t&&(n=r,i=e.apply(this,arguments)):(n=r,i=e.apply(this,arguments)),i}},isFunction:function(t){var e={};return t&&"[object Function]"===e.toString.call(t)}}),n("OffScreenHandlerFactory",[],function(){function t(){var t=function(t,e){return function(n,i,r,o,u){var s=n.getWidthAndHeight(),a=n.getPosition();"down"===o?(n.setPosition(a.x,r-s.height),n.setSpeedY(-n.getSpeedY()*t),n.setSpeedX(n.getSpeedX()*(1-e))):"top"===o?(n.setPosition(a.x,s.height),n.setSpeedY(-n.getSpeedY()*t),n.setSpeedX(n.getSpeedX()*(1-e))):"right"===o?(n.setPosition(i-s.width,a.y),n.setSpeedX(-n.getSpeedX()*t)):"left"===o&&(n.setPosition(0,a.y),n.setSpeedX(-n.getSpeedX()*t))}},e=function(t,e,n,i,r){var o=t.getPosition(),u=t.getWidthAndHeight();"right"===i?t.setPosition(0,o.y):"left"===i&&t.setPosition(e-u.width,o.y),"down"===i?t.setPosition(o.x,0):"top"===i&&t.setPosition(o.x,n-u.height)},n=function(t){t.setDestroyed()};this.getOffScreenHandler=function(i){return"wrapping"===i?e:"bouncing"===i?t.apply(this,Array.prototype.slice.call(arguments,1)):"destructive"===i?n:void 0}}return new t}),n("line-intersect",[],function(){function t(){function t(t,e){return t.x*e.y-t.y*e.x}function e(t,e){var n={};return n.x=t.x-e.x,n.y=t.y-e.y,n}this.getLineSegmentsIntersect=function(n,i,r,o){var u=e(i,n),s=e(o,r),a=t(e(r,n),u),f=t(u,s);if(0===a&&0===f)return Number.MAX_VALUE;if(0===f)return Number.MAX_VALUE;var h=a/f,c=t(e(r,n),s)/f;return c>=0&&1>=c&&h>=0&&1>=h?c:Number.MAX_VALUE}}return new t}),n("RectangularCollisionStartegy",["line-intersect"],function(t){function e(){var e=function(t,e){return{left:t.x-e.maxX,top:t.y-e.maxY,width:t.width+e.width,height:t.height+e.height}},n=function(t){var e="left",n=Math.abs(t.left);return Math.abs(t.left+t.width)<n&&(n=Math.abs(t.left+t.width),e="right"),Math.abs(t.top+t.height)<n&&(n=Math.abs(t.top+t.height),e="down"),Math.abs(t.top)<n&&(e="top"),e},i=function(e,n){var i,r={x:0,y:0},o=n,u=e.top,s=e.top+e.height,a=e.left,f=e.left+e.width,h=t.getLineSegmentsIntersect(r,o,{x:a,y:u},{x:a,y:s});return i=t.getLineSegmentsIntersect(r,o,{x:a,y:s},{x:f,y:s}),h>i&&(h=i),i=t.getLineSegmentsIntersect(r,o,{x:f,y:s},{x:f,y:u}),h>i&&(h=i),i=t.getLineSegmentsIntersect(r,o,{x:f,y:u},{x:a,y:u}),h>i&&(h=i),h},r=function(t){return{x:t.getPosition().x,y:t.getPosition().y,maxX:t.getPosition().x+t.getWidthAndHeight().width,maxY:t.getPosition().y+t.getWidthAndHeight().height,width:t.getWidthAndHeight().width,height:t.getWidthAndHeight().height}},o=function(t,e){var n=t.getSpeedX()-e.getSpeedX(),i=t.getSpeedY()-e.getSpeedY();return{x:-n,y:i}};this.collision=function(t,u){var s=r(t),a=r(u),f=e(s,a);if(f.left<=0&&f.left+f.width>=0&&f.top<=0&&f.top+f.height>=0)return n(f);var h=o(t,u),c=i(f,h);if(c!==Number.MAX_VALUE){s.x=s.x+t.getSpeedX()*c,s.maxX=s.x+s.width,s.y=s.y-t.getSpeedY()*c,s.maxY=s.y+s.height,a.x=a.x+u.getSpeedX()*c,a.maxX=a.x+a.width,a.y=a.y-u.getSpeedY()*c,a.maxY=a.y+a.height;var f=e(s,a);if(f.left<=0&&f.left+f.width>=0&&f.top<=0&&f.top+f.height>=0)return n(f)}}}return new e}),n("Engine",["Util","OffScreenHandlerFactory","RectangularCollisionStartegy"],function(t,e,n){function i(i){var r,o,u,s=document.getElementById(i),a=s.getContext("2d"),f=[],h=!1,c=this;this.addSprite=function(t){f.push(t)},this.addSprites=function(t){f=f.concat(t)};var o=function(t,e,n){},d=function(){},l=function(t){},g=function(t,e){return function(n,i,r,o){var u=r.getPosition(),s=r.getWidthAndHeight();return u.x<-t?"left":u.x>n-s.width+t?"right":u.y<-e?"top":u.y>i-s.height+e?"down":void 0}},p=g(0,0),m={};document.addEventListener("keydown",function(t){m[t.keyCode]=t},!0),document.addEventListener("keyup",function(t){delete m[t.keyCode]},!0),this.withUpdateHandler=function(t){return o=t,this},this.withCollisionHandler=function(t){return d=t,this},this.withDestructionHandler=function(t){return l=t,this},this.withCollisionDetector=function(){return h=!0,this},this.withGlobalOffScreenHandler=function(n){return u=t.isFunction(n)?n:e.getOffScreenHandler.apply(this,arguments),this};var y=function(){var t,e=0;return function(n){e++,t||(t=n),n-t>1e3&&(console.log(e),e=0,t=n)}};this.start=function(){var t=y(),e=function(n){t(n);var i=s.width,d=s.height;a.clearRect(0,0,s.width,s.height),h&&(c.detectCollisions(n),f.forEach(function(t){t.isDestroyed(n)&&(t.handleDestruction(n),l(t,n))}),f.forEach(function(t){var e=p(i,d,t);if(e){var r=t.handleOffScreen(i,d,e,n);r||u(t,i,d,e,n)}}),f=f.filter(function(t){return!t.isDestroyed(n)})),o(a,n,m),f.forEach(function(t){t.handleKeyEvents(m,n),t.handleUpdate(n),t.draw(a,n)}),r=requestAnimationFrame(e)};r=requestAnimationFrame(e)};var v=function(t){return"top"===t?"down":"down"===t?"top":"right"===t?"left":"left"===t?"right":t};this.detectCollisions=function(){for(var t=0;t<f.length;t++)for(var e=t+1;e<f.length;e++){var i=n.collision(f[t],f[e]);i&&t!==e&&(f[t].handleCollision(f[e],i),f[e].handleCollision(f[t],v(i)),d(f[t],f[e]))}},this.forEach=function(t){f.forEach(t)}}return i}),n("Animator",[],function(){function t(t,e,n,i,r,o,u,s,a,f){var h,c,d,l,g,p=document.getElementById(t),m=!1;this.setPosition=function(t,e){h=t,c=e},this.setWidthAndHeight=function(t,e){l=t,g=e};var y=function(){var t=(new Date).getTime(),d=0,y=0,v=0;return function(w){var S=(new Date).getTime();v>a&&(m=!0),S-t>s&&(v++,d=v%f,y=Math.floor(v/f),t=S),w.drawImage(p,e+o*d,n+u*y,i,r,h,c,l,g)}};this.animate=function(t){return void 0===d&&(d=y()),d(t)},this.isCompleted=function(){return m}}return t}),n("Sprite",["OffScreenHandlerFactory","Util","Animator"],function(t,e,n){function i(i){var r,o,u,s,a=0,f=0,h=0,c=0,d=0,l=0,g=0,p=!1,m=this;this.setImage=function(t){return r=document.getElementById(t),this},this.setPosition=function(t,e){return a=t,f=e,this},this.getPosition=function(){return{x:a,y:f}},this.increaseSpeedX=function(t){return d+=t,this},this.increaseSpeedY=function(t){return l+=t,this},this.setSpeedX=function(t){return d=t,this},this.setSpeedY=function(t){return l=t,this},this.getSpeedX=function(){return d},this.getSpeedY=function(){return l},this.setWidthAndHeight=function(t,e){return h=t,c=e,g=h>c?h/2:c/2,this},this.getWidthAndHeight=function(){return{width:h,height:c}},this.setAngle=function(t){return u=t,this},this.addForceVector=function(t,e){d+=Math.cos(t*Math.PI/180)*e,l+=Math.sin(t*Math.PI/180)*e};var y=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},v=function(t,e){var n=180*Math.atan2(e,t)/Math.PI;return 0>n&&(n=360+n),n};this.relativeForce=function(t){var e=d-t.getSpeedX(),n=l-t.getSpeedY();return{force:y(e,n),angle:v(e,n)}},this.relativeSpeed=function(t){var e=d-t.getSpeedX(),n=l-t.getSpeedY();return{x:-e,y:n}},this.getForceVector=function(){return{force:y(d,l),angle:v(d,l)}},this.getRadius=function(){return g},this.handleUpdate=function(){},this.handleCollision=function(t){},this.handleKeyEvents=function(t){},this.handleDestruction=function(){},this.isDestroyed=function(){return p},this.setDestroyed=function(){p=!0},this.getAngleAndDistance=function(t){var e=t.getPosition(),n=e.x-a,i=e.y-f,r=180*Math.atan2(i,n)/Math.PI;r=r>0?360-r:-r;var o=Math.sqrt(Math.pow(n,2)+Math.pow(i,2));return{angle:r,distance:o}};var w=function(t){r&&(a+=d,f-=l,h&&c?t.drawImage(r,a,f,h,c):h&&!c?t.drawImage(r,a,f,h):c?t.drawImage(r,a,f,h,c):t.drawImage(r,a,f))},S=function(t){return a+=d,f-=l,o.setPosition(a,f),o.setWidthAndHeight(h,c),o.animate(t)};this.draw=function(t){t.save(),o?S(t):w(t),t.restore()},this.animationCompleted=function(){return o.isCompleted()},this.setAnimation=function(t,e,i,r,u,s,a,f,h,c){return o=new n(t,e,i,r,u,s,a,f,h,c),this},this.setAnimator=function(t){return o=t,this},this.drawCircle=function(t){t.beginPath(),t.arc(a+h/2,f+c/2,g,0,2*Math.PI),t.stroke()},this.handleOffScreen=function(t,e,n,i){return s?(s(m,t,e,n,i),!0):!1},this.withOffScreenHandler=function(n){return s=e.isFunction(n)?n:t.getOffScreenHandler.apply(this,arguments),this},i.addSprite(this)}return i}),n("game_engine",["Engine","Sprite","Util","Animator"],function(t,e,n,i){return{engine:t,sprite:e,util:n,Animator:i}}),t.config({baseUrl:"src"}),e(["game_engine"],function(t){}),n("main",function(){}),e("game_engine")});